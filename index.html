<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>学习途径与作品关系可视化</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --highlight-color: #ffeb3b;
            --required-color: #e74c3c;
            --path-colors: #9b59b6, #1abc9c, #f39c12, #2ecc71;
            --border-radius: 10px;
            --card-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --transition: all 0.3s ease;

            /* 作品类型颜色 */
            --novel-color: #e64e4e;
            --anime-color: #f79743;
            --game-color: #82c6fa;
            --video-color: #79e671;
            --book-color: #f6f073;
            --daily-color: #aa67ed;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4edf5 100%);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }

        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
            background: linear-gradient(90deg, #9b59b6, #3498db);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        .subtitle {
            color: #7f8c8d;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
        }

        .dashboard {
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            gap: 25px;
            margin-bottom: 40px;
        }

        .panel {
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            padding: 25px;
            height: 100%;
            transition: var(--transition);
            display: flex;
            flex-direction: column;
        }

        .panel:hover {
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .panel h2 {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            color: #2c3e50;
            display: flex;
            align-items: center;
            font-size: 1.4rem;
        }

        .panel h2 i {
            margin-right: 12px;
            font-size: 1.5rem;
            width: 35px;
            height: 35px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: #f0f7ff;
            border-radius: 50%;
        }

        .cards-container {
            display: flex;
            flex-direction: column;
            gap: 18px;
            flex-grow: 1;
        }

        .multi-column {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 18px;
        }

        .card {
            padding: 20px;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            background: white;
            border: 2px solid transparent;
            display: flex;
            flex-direction: column;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: var(--primary-color);
            transition: var(--transition);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.15);
        }

        .card.required {
            border-color: var(--required-color);
        }

        .card.required::before {
            background: var(--required-color);
        }

        .card.work {
            border-left: 5px solid var(--anime-color);
        }

        .card.path {
            border-left: 5px solid #9b59b6;
        }

        .card.highlight {
            background: var(--highlight-color);
            transform: scale(1.05);
            z-index: 20;
            border-color: var(--primary-color);
        }

        .card-title {
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 1.15rem;
            color: #2c3e50;
            line-height: 1.3;
        }

        .card-meta {
            font-size: 0.9rem;
            color: #7f8c8d;
            display: flex;
            align-items: center;
            margin-top: auto;
            padding-top: 10px;
            border-top: 1px dashed #eee;
        }

        .card-meta .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-right: 8px;
            font-weight: 500;
        }

        .required-badge {
            background-color: var(--required-color);
            color: white;
        }

        .type-badge {
            background-color: #eee;
            color: #333;
        }

        .connections {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .connection {
            position: absolute;
            background: rgba(52, 152, 219, 0.4);
            z-index: -1;
            transition: var(--transition);
        }

        .legend {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 30px;
            padding: 20px;
            background: white;
            border-radius: var(--border-radius);
            box-shadow: var(--card-shadow);
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .legend-color {
            width: 22px;
            height: 22px;
            border-radius: 4px;
        }

        .legend-required {
            background: var(--required-color);
        }

        .legend-path {
            background: #9b59b6;
        }

        .legend-highlight {
            background: var(--highlight-color);
        }

        .legend-novel {
            background: var(--novel-color);
        }

        .legend-anime {
            background: var(--anime-color);
        }

        .legend-game {
            background: var(--game-color);
        }

        .legend-video {
            background: var(--video-color);
        }

        .legend-book {
            background: var(--book-color);
        }

        .legend-daily {
            background: var(--daily-color);
        }

        .instructions {
            text-align: center;
            margin-top: 20px;
            color: #7f8c8d;
            font-style: italic;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2rem;
            color: #7f8c8d;
        }

        .type-indicator {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }

        @media (max-width: 1100px) {
            .dashboard {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto auto;
            }

            .panel {
                min-height: 300px;
            }
        }

        @media (max-width: 768px) {
            .multi-column {
                grid-template-columns: 1fr;
            }

            h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-book-open"></i> 学习途径与作品关系可视化</h1>
            <p class="subtitle">点击卡片可查看学习途径与推荐作品之间的关系，红色边框作品为必读材料</p>
        </header>

        <div class="dashboard">
            <div class="panel">
                <h2><i class="fas fa-star"></i> 必读作品</h2>
                <div class="cards-container" id="required-works">
                    <div class="loading">加载必读作品数据中...</div>
                </div>
            </div>

            <div class="panel">
                <h2><i class="fas fa-book"></i> 其他作品</h2>
                <div class="multi-column" id="other-works">
                    <div class="loading">加载其他作品数据中...</div>
                </div>
            </div>

            <div class="panel">
                <h2><i class="fas fa-route"></i> 学习途径</h2>
                <div class="cards-container" id="paths">
                    <div class="loading">加载学习途径数据中...</div>
                </div>
            </div>
        </div>

        <div class="legend">
            <div class="legend-item">
                <div class="legend-color legend-required"></div>
                <span>必读作品</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-path"></div>
                <span>学习途径</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-highlight"></div>
                <span>高亮关联项</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-novel"></div>
                <span>小说</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-anime"></div>
                <span>动漫</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-game"></div>
                <span>游戏</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-video"></div>
                <span>影视</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-book"></div>
                <span>书籍</span>
            </div>
            <div class="legend-item">
                <div class="legend-color legend-daily"></div>
                <span>日常</span>
            </div>
        </div>

        <p class="instructions">提示：鼠标悬停在卡片上可查看关联的学习途径和作品</p>
    </div>

    <script>
        // 作品类型到颜色的映射
        const workTypeColors = {
            'novel': 'var(--novel-color)',
            'anime': 'var(--anime-color)',
            'game': 'var(--game-color)',
            'video': 'var(--video-color)',
            'book': 'var(--book-color)',
            'daily': 'var(--daily-color)'
        };

        // 从外部加载数据
        let data = null;

        // 初始化函数
        async function init() {
            try {
                // 从data.json加载数据
                const response = await fetch('data.json');
                if (!response.ok) {
                    throw new Error('网络响应异常');
                }
                data = await response.json();

                // 渲染界面
                renderRequiredWorks();
                renderOtherWorks();
                renderPaths();
                setupEventListeners();
            } catch (error) {
                console.error('加载数据失败:', error);
                document.querySelectorAll('.loading').forEach(el => {
                    el.innerHTML = `<div style="color: #e74c3c; padding: 20px;">
                        <i class="fas fa-exclamation-triangle"></i> 加载数据失败，请检查data.json文件
                    </div>`;
                });
            }
        }

        // 渲染必读作品
        function renderRequiredWorks() {
            const container = document.getElementById('required-works');
            container.innerHTML = '';

            const requiredWorks = data.works.filter(work => work.required);

            if (requiredWorks.length === 0) {
                container.innerHTML = '<div class="no-data">暂无必读作品</div>';
                return;
            }

            requiredWorks.forEach(work => {
                const card = createCardElement(work, 'work required');
                container.appendChild(card);
            });
        }

        // 渲染其他作品
        function renderOtherWorks() {
            const container = document.getElementById('other-works');
            container.innerHTML = '';

            const otherWorks = data.works.filter(work => !work.required);

            if (otherWorks.length === 0) {
                container.innerHTML = '<div class="no-data">暂无其他作品</div>';
                return;
            }

            otherWorks.forEach(work => {
                const card = createCardElement(work, 'work');
                container.appendChild(card);
            });
        }

        // 渲染学习途径
        function renderPaths() {
            const container = document.getElementById('paths');
            container.innerHTML = '';

            if (data.paths.length === 0) {
                container.innerHTML = '<div class="no-data">暂无学习途径</div>';
                return;
            }

            data.paths.forEach(path => {
                const card = createCardElement(path, 'path');
                container.appendChild(card);
            });
        }

        // 创建卡片元素
        function createCardElement(item, type) {
            const card = document.createElement('div');
            card.className = `card ${type}`;
            card.dataset.id = item.id;
            card.dataset.type = item.type || 'work';

            const title = document.createElement('div');
            title.className = 'card-title';
            title.textContent = item.title;

            const meta = document.createElement('div');
            meta.className = 'card-meta';

            // 为作品添加类型徽章
            if (type.includes('work')) {
                if (item.required) {
                    const badge = document.createElement('span');
                    badge.className = 'badge required-badge';
                    badge.textContent = '必读';
                    meta.appendChild(badge);
                }

                if (item.type) {
                    const typeBadge = document.createElement('span');
                    typeBadge.className = 'badge type-badge';
                    typeBadge.textContent = getTypeName(item.type);
                    meta.appendChild(typeBadge);
                }
            }

            card.appendChild(title);
            card.appendChild(meta);

            // 添加类型指示器
            if (type.includes('work') && item.type) {
                const indicator = document.createElement('div');
                indicator.className = 'type-indicator';
                indicator.style.backgroundColor = workTypeColors[item.type] || workTypeColors['other'];
                card.appendChild(indicator);
            }

            // 设置作品卡片左边框颜色
            if (type.includes('work') && item.type) {
                card.style.borderLeftColor = workTypeColors[item.type] || workTypeColors['other'];
            }

            // 添加连接层
            const connectionsLayer = document.createElement('div');
            connectionsLayer.className = 'connections';
            card.appendChild(connectionsLayer);

            return card;
        }

        // 获取类型名称
        function getTypeName(type) {
            const typeNames = {
                'novel': '小说',
                'anime': '动漫',
                'game': '游戏',
                'video': '电影',
                'book': '书籍',
                'daily': '日常',
            };
            return typeNames[type] || '未知类型';
        }

        // 设置事件监听器
        function setupEventListeners() {
            const cards = document.querySelectorAll('.card');

            cards.forEach(card => {
                // card.addEventListener('mouseenter', handleCardHover);
                // card.addEventListener('mouseleave', clearHighlights);
                card.addEventListener('click', handleCardHover);
            });
        }

        // 处理卡片悬停事件
        function handleCardHover(event) {
            const card = event.currentTarget;
            const cardId = card.dataset.id;

            // 清除之前的高亮
            clearHighlights();

            // 高亮当前卡片
            card.classList.add('highlight');

            // 查找并高亮相关卡片
            const connectedIds = findConnectedCards(cardId);

            connectedIds.forEach(id => {
                const connectedCard = document.querySelector(`.card[data-id="${id}"]`);
                if (connectedCard) {
                    connectedCard.classList.add('highlight');
                }
            });

            // 绘制连接线
            drawConnections(card, connectedIds);
        }

        // 查找相关卡片
        function findConnectedCards(cardId) {
            const connectedIds = new Set();

            data.connections.forEach(conn => {
                if (conn.from === cardId) {
                    connectedIds.add(conn.to);
                }
                if (conn.to === cardId) {
                    connectedIds.add(conn.from);
                }
            });

            return Array.from(connectedIds);
        }

        // 绘制连接线
        function drawConnections(sourceCard, targetIds) {
            const sourceRect = sourceCard.getBoundingClientRect();
            const sourceX = sourceRect.left + sourceRect.width / 2;
            const sourceY = sourceRect.top + sourceRect.height / 2;

            targetIds.forEach(targetId => {
                const targetCard = document.querySelector(`.card[data-id="${targetId}"]`);
                if (targetCard) {
                    const targetRect = targetCard.getBoundingClientRect();
                    const targetX = targetRect.left + targetRect.width / 2;
                    const targetY = targetRect.top + targetRect.height / 2;

                    drawConnectionLine(sourceCard, sourceX, sourceY, targetX, targetY);
                }
            });
        }

        // 绘制连接线
        function drawConnectionLine(sourceCard, x1, y1, x2, y2) {
            const connectionsLayer = sourceCard.querySelector('.connections');

            // 计算线条长度和角度
            const length = Math.sqrt(Math.pow(x2 - x1, 2) + Math.pow(y2 - y1, 2));
            const angle = Math.atan2(y2 - y1, x2 - x1) * 180 / Math.PI;

            // 创建连接线元素
            const connection = document.createElement('div');
            connection.className = 'connection';

            // 设置线条位置和样式
            connection.style.width = `${length}px`;
            connection.style.transform = `rotate(${angle}deg)`;
            connection.style.top = `${y1}px`;
            connection.style.left = `${x1}px`;

            connectionsLayer.appendChild(connection);
        }

        // 清除所有高亮
        function clearHighlights() {
            document.querySelectorAll('.card.highlight').forEach(card => {
                card.classList.remove('highlight');
            });

            document.querySelectorAll('.connection').forEach(conn => {
                conn.remove();
            });
        }

        // 初始化应用
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>

</html>